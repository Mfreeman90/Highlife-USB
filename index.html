<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HighLife Data Crack Simulator</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@800&display=swap');
        $part-width: 60px;
        $part-height: 100px;

        body {
            margin: 0;
            top: 0;
            position: absolute;
            color: #fff;
            background-color: #101010;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden; 
            width: 100vw;
        }

        .content {
            display: flex;
            flex-direction: column;
            width: 100vw;
            text-align: center;
            margin-top: 20px;
        }

        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #00ff00;
            text-shadow: 0 0 20px #00ff00;
            z-index: 10;
            width: 100%;
            pointer-events: none;
            animation: flash 0.5s infinite;
            display: flex;
            flex-direction: column;
        }

        .win-message .subtitle {
            font-size: 1.2rem;
            color: yellow;
            text-shadow: 0 0 10px yellow;
            margin-top: 10px;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
        }

        .top-contents hr {
            border: 2px solid;
            width: 100%;
        }
        .top-contents hr.yellow { transform: translateY(40px); border-color: yellow; }
        .top-contents hr.orange { transform: translateY(40px); border-color: orange; }

        .title {
            transform: translateY(-16px);
            background-color: #101010;
            font-size: 3em;
            width: 350px;
            margin: auto;
        }
        .catch-phrase { margin: 0; color: yellow; }

        .container {
            width: 90%;
            max-width: 500px;
            margin: auto;
        }

        .crack-container {
            position: relative;
            transform: translateY(-25px);
            margin: 2px;
        }

        .white-bar-container {
            background-color: #202020;
            border: 3px solid red;
            min-height: 400px;
            display: grid;
            grid-template-columns: repeat(6, 1fr); 
        }

        .crack-slider {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 250px;
            outline: none; 
        }
        
        .core { height: 50px; }
        
        .part {
            background-color: white;
            width: 60px; 
            height: 100px;
        }
        
        .active .part {
            border: 4px solid #e6e600;
            width: 52px; 
            height: 92px;
        }

        .target-bar {
            width: 100%;
            height: 35px; 
            background-color: red;
            position: relative;
            top: 232px; 
            z-index: 1;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div id="miniGame"></div>

    <script type="text/babel">
        const pixelTolerance = 16;      
        const initialAnimationTime = 550; 
        let animations = [];

        const animationTemplate = {
            autoplay: true,
            translateY: 150,
            loop: true,
            easing: 'easeInOutSine',
            direction: 'alternate'
        }

        const createAnimationObject = (id, index) => {
            let speedAdjustment = index <= 2 ? 80 * index : (80 * 2) + (30 * (index - 2));
            return anime({
                targets: id,
                duration: Math.max(initialAnimationTime - speedAdjustment, 150), 
                ...animationTemplate
            });
        }

        const CrackSlider = ({isActive, index, reactRef}) => (
            <div className={`crack-slider ${isActive ? 'active' : ''}`} id={`slider-${index}`}>
                <div className='top part'/><div className='core' ref={reactRef} /><div className='bottom part'/>
            </div>
        );

        const CrackContainer = () => {
            const [captured, setCaptured] = React.useState([false, false, false, false, false, false]);
            const [activeIndex, setActiveIndex] = React.useState(0);
            const [gameWon, setGameWon] = React.useState(false);
            const coreRefs = React.useRef(captured.map(() => React.createRef()));
            const targetRef = React.useRef(); 

            const initAnimations = () => {
                animations.forEach(a => a.pause());
                animations = captured.map((_, index) => createAnimationObject(`#slider-${index}`, index));
            };

            React.useEffect(() => { initAnimations(); }, [gameWon]);

            React.useEffect(() => {
                const handleKeyPress = (e) => {
                    if (e.code === 'Space' && !gameWon) { e.preventDefault(); checkPosition(); }
                };
                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [activeIndex, gameWon]); 

            const checkPosition = () => {
                const coreDimensions = coreRefs.current[activeIndex].current.getBoundingClientRect();
                const targetDimensions = targetRef.current.getBoundingClientRect();
                const isHit = (coreDimensions.top > (targetDimensions.top - pixelTolerance)) && 
                              (coreDimensions.top < (targetDimensions.top + pixelTolerance));

                if(isHit){
                    animations[activeIndex].pause();
                    if (activeIndex === captured.length - 1) { 
                        setGameWon(true); 
                        setTimeout(() => { setGameWon(false); setActiveIndex(0); }, 2000); 
                    } else { setActiveIndex(activeIndex + 1); }
                } else if (activeIndex > 0) {
                    animations[activeIndex - 1].play(); setActiveIndex(activeIndex - 1); 
                }
            }
            
            return (
                <div className='crack-container'>
                    {gameWon && <div className="win-message">WINNER WINNER<span className="subtitle">CHICKEN DINNER</span></div>}
                    <div className='target-bar' ref={targetRef} />
                    <div className="white-bar-container">
                        {captured.map((_, index) => (
                            <CrackSlider key={`${gameWon}-${index}`} index={index} isActive={index === activeIndex && !gameWon} reactRef={coreRefs.current[index]} />
                        ))}
                    </div>
                </div>
            );
        }

        const App = () => (
            <div className='content'>
                <div className='top-contents'><hr className='yellow'/><hr className='orange'/><h3 className="title">Data Crack</h3><p className='catch-phrase'>Selling your secrets since 1996</p></div>
                <div className='container'><CrackContainer /></div>
                <p>Use <strong>SPACEBAR</strong> to hit the bars.</p> 
            </div>
        );

        ReactDOM.render(<App />, document.getElementById('miniGame'));
    </script>
</body>
</html>
