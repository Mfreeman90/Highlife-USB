<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Crack - Heist Edition</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&display=swap');
        
        body { 
            margin: 0; background-color: #3e166b;
            color: white; font-family: 'Arial', sans-serif; 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            overflow: hidden;
        }

        .window-frame {
            border: 3px solid #5baade;
            background-color: #050505;
            width: 950px;
            font-family: 'Orbitron', sans-serif;
            position: relative;
        }

        .header {
            border-bottom: 2px solid #f7931e;
            padding: 12px;
            text-align: center;
            background: #000;
        }

        .header-title { color: #f7931e; font-size: 3rem; font-weight: 900; margin: 0; letter-spacing: 4px; }

        .game-viewport {
            position: relative;
            height: 550px;
            margin: 30px auto;
            width: 850px;
            border: 3px solid #ff0000;
            background-color: #000;
            overflow: hidden; 
        }

        .target-line { 
            position: absolute; 
            width: 100%; 
            height: 25px; 
            background: #ff0000; 
            top: 50%;
            transform: translateY(-50%);
            z-index: 1; 
        }

        .bars-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            gap: 30px; 
            position: relative;
            z-index: 10;
        }

        .slider-column { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            position: relative;
        }
        
        .part { background-color: white; width: 45px; height: 150px; }
        .spacer { height: 40px; background: transparent; width: 100%; } 

        .active .part { 
            outline: 4px solid #fdf5a2;
            box-shadow: 0 0 15px #fdf5a2;
        }

        .win-message { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            color: #00ff00; font-size: 3.5rem; z-index: 100; 
            background: rgba(0,0,0,0.95); padding: 30px; border: 3px solid #00ff00;
            text-align: center; width: 85%;
        }

        .start-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center; z-index: 200;
        }
        .start-btn {
            background: #f7931e; color: black; border: none; padding: 20px 40px;
            font-family: 'Orbitron'; font-size: 1.5rem; cursor: pointer; font-weight: 900;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [activeIndex, setActiveIndex] = useState(0);
            const [won, setWon] = useState(false);
            const [started, setStarted] = useState(false);
            const bars = [0, 1, 2, 3, 4, 5, 6, 7]; 
            const refs = useRef(bars.map(() => React.createRef()));
            const animations = useRef([]);
            const audioCtx = useRef(null);

            // SOUND: Mechanical Mouse Click
            const playMouseClick = () => {
                if (!audioCtx.current) return;
                const now = audioCtx.current.currentTime;
                
                // High frequency "tick"
                const osc = audioCtx.current.createOscillator();
                const gain = audioCtx.current.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.05);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.05);
                
                osc.connect(gain);
                gain.connect(audioCtx.current.destination);
                osc.start(now);
                osc.stop(now + 0.05);

                // Noise burst for the "click" texture
                const bufferSize = audioCtx.current.sampleRate * 0.02;
                const buffer = audioCtx.current.createBuffer(1, bufferSize, audioCtx.current.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                
                const noise = audioCtx.current.createBufferSource();
                const noiseGain = audioCtx.current.createGain();
                noise.buffer = buffer;
                noiseGain.gain.setValueAtTime(0.05, now);
                noiseGain.gain.linearRampToValueAtTime(0, now + 0.02);
                
                noise.connect(noiseGain);
                noiseGain.connect(audioCtx.current.destination);
                noise.start(now);
            };

            // SOUND: Faint School Bell Ringing in background
            const startFaintBell = () => {
                audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                
                const playBellPulse = () => {
                    const now = audioCtx.current.currentTime;
                    const osc = audioCtx.current.createOscillator();
                    const gain = audioCtx.current.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(2500, now); // High pitch ringing
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.015, now + 0.02); // Very faint
                    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.8);
                    
                    osc.connect(gain);
                    gain.connect(audioCtx.current.destination);
                    osc.start(now);
                    osc.stop(now + 1);
                };

                // Interval to simulate the ringing pattern
                setInterval(playBellPulse, 150);
            };

            const initGame = () => {
                animations.current.forEach(anim => anim && anim.pause());
                animations.current = bars.map((i) => {
                    let speed = 750 - (i * 80);
                    if (i >= 6) { speed += 180; } 
                    return anime({
                        targets: `#col-${i}`,
                        translateY: [-180, 180], 
                        duration: Math.max(speed, 250),
                        direction: 'alternate',
                        loop: true,
                        easing: 'easeInOutSine',
                        autoplay: true
                    });
                });
            };

            useEffect(() => {
                if (started) initGame();
                return () => animations.current.forEach(anim => anim && anim.pause());
            }, [won, started]);

            const handleInteraction = () => {
                if (won || !started) return;
                const targetRect = document.querySelector('.target-line').getBoundingClientRect();
                const spacerRect = refs.current[activeIndex].current.getBoundingClientRect();
                const targetCenter = targetRect.top + (targetRect.height / 2);
                const spacerCenter = spacerRect.top + (spacerRect.height / 2);
                const isHit = Math.abs(spacerCenter - targetCenter) < 18;

                if (isHit) {
                    playMouseClick();
                    animations.current[activeIndex].pause();
                    anime({
                        targets: `#col-${activeIndex}`,
                        translateY: 0, 
                        duration: 40,
                        easing: 'linear'
                    });

                    if (activeIndex === bars.length - 1) {
                        setWon(true);
                    } else { 
                        setActiveIndex(activeIndex + 1); 
                    }
                } else if (activeIndex > 0) {
                    const prev = activeIndex - 1;
                    animations.current[prev].play();
                    setActiveIndex(prev);
                }
            };

            useEffect(() => {
                window.addEventListener('mousedown', handleInteraction);
                return () => window.removeEventListener('mousedown', handleInteraction);
            }, [activeIndex, won, started]);

            return (
                <div className="window-frame">
                    {!started && (
                        <div className="start-overlay">
                            <button className="start-btn" onClick={() => {setStarted(true); startFaintBell();}}>START HACK</button>
                        </div>
                    )}
                    <div className="header">
                        <h1 className="header-title">DATA CRACK</h1>
                    </div>
                    <div className="game-viewport">
                        <div className="target-line" />
                        <div className="bars-container">
                            {bars.map((i) => (
                                <div 
                                    key={i}
                                    id={`col-${i}`} 
                                    className={`slider-column ${i === activeIndex ? 'active' : ''}`}
                                >
                                    <div className="part" />
                                    <div className="spacer" ref={refs.current[i]} />
                                    <div className="part" />
                                </div>
                            ))}
                        </div>
                        {won && <div className="win-message">ACCESS GRANTED</div>}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
