<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Crack - HighLife Edition</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&display=swap');
        
        body { 
            margin: 0; background-color: #3e166b;
            color: white; font-family: 'Arial', sans-serif; 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            overflow: hidden;
            position: relative;
        }

        /* Desktop Icons */
        .desktop-icon {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100px;
        }

        .my-computer { top: 30px; left: 30px; }
        .power-off { top: 30px; right: 30px; }

        .icon-box {
            width: 60px; height: 60px;
            margin-bottom: 5px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .computer-img { background-image: url('https://img.icons8.com/fluency/96/computer.png'); }
        .power-img { background-image: url('https://img.icons8.com/fluency/96/shutdown.png'); }

        .icon-label { font-size: 14px; text-shadow: 1px 1px 2px #000; }

        /* Window frame */
        .window-frame {
            border: 4px solid #5baade;
            background-color: #050505;
            box-shadow: 10px 10px 30px rgba(0,0,0,0.7);
            width: 1000px;
            z-index: 10;
            font-family: 'Orbitron', sans-serif;
        }

        .header {
            border-bottom: 2px solid #5baade;
            padding: 15px;
            text-align: center;
            background: linear-gradient(180deg, #222 0%, #000 100%);
        }

        .header-title {
            color: #f7931e;
            font-size: 4.5rem;
            font-weight: 900;
            margin: 0;
            letter-spacing: 6px;
            text-shadow: 3px 3px #000;
        }

        .header-subtitle {
            color: #f7931e;
            font-size: 1rem;
            margin-top: -5px;
            letter-spacing: 3px;
        }

        .crack-container { 
            position: relative; 
            background-color: #000;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            height: 600px;
            display: grid; 
            grid-template-columns: repeat(8, 1fr); 
            padding: 0 50px;
            align-items: center;
            overflow: hidden;
            border: 15px solid #000;
        }

        .red-boundary {
            position: absolute;
            top: 20px; bottom: 20px; left: 20px; right: 20px;
            border: 4px solid #ff0000;
            pointer-events: none;
            z-index: 1;
        }

        .target-line { 
            position: absolute; 
            width: 100%; 
            height: 50px; 
            background: rgba(255, 0, 0, 0.9); 
            top: 50%;
            transform: translateY(-50%);
            z-index: 5; 
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .slider-column { display: flex; flex-direction: column; align-items: center; height: 100%; position: relative; }
        
        /* The White Bars */
        .part { background-color: white; width: 45px; height: 160px; }
        
        /* The Gap (Space for the red bar) */
        .spacer { height: 60px; background: transparent; } 

        .active .part { 
            outline: 5px solid #fdf5a2; 
            box-shadow: 0 0 20px #fdf5a2;
        }

        .win-message { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            color: #00ff00; font-size: 4rem; z-index: 20; 
            text-shadow: 0 0 25px #00ff00; font-weight: 900;
            background: rgba(0,0,0,0.9); padding: 40px; border: 2px solid #00ff00;
            width: 85%; text-align: center;
        }
    </style>
</head>
<body>
    <div class="desktop-icon my-computer">
        <div class="icon-box computer-img"></div>
        <div class="icon-label">My Computer</div>
    </div>
    
    <div class="desktop-icon power-off">
        <div class="icon-box power-img"></div>
        <div class="icon-label">Power Off</div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [activeIndex, setActiveIndex] = useState(0);
            const [lockedBars, setLockedBars] = useState([]);
            const [won, setWon] = useState(false);
            const bars = [0, 1, 2, 3, 4, 5, 6]; 
            const refs = useRef(bars.map(() => React.createRef()));
            const animations = useRef([]);

            const initGame = () => {
                animations.current.forEach(anim => anim && anim.pause());
                animations.current = bars.map((i) => {
                    const speed = 700 - (i * 40); 
                    return anime({
                        targets: `#col-${i}`,
                        translateY: [-220, 220], 
                        duration: speed, 
                        direction: 'alternate',
                        loop: true,
                        easing: 'easeInOutSine',
                        autoplay: true
                    });
                });
            };

            useEffect(() => {
                initGame();
                return () => animations.current.forEach(anim => anim && anim.pause());
            }, [won]);

            useEffect(() => {
                const handleInteraction = (e) => {
                    if (won) return;
                    
                    const targetLine = document.querySelector('.target-line').getBoundingClientRect();
                    const spacer = refs.current[activeIndex].current.getBoundingClientRect();
                    
                    const spacerCenter = spacer.top + (spacer.height / 2);
                    const targetCenter = targetLine.top + (targetLine.height / 2);
                    
                    // Hit logic: checking if the center of the gap is inside the red bar
                    const isHit = Math.abs(spacerCenter - targetCenter) < (targetLine.height / 2 + 5);

                    if (isHit) {
                        animations.current[activeIndex].pause();

                        // SNAP LOGIC: We calculate the offset needed to center the spacer on the target
                        // 0 is the CSS default center.
                        anime({
                            targets: `#col-${activeIndex}`,
                            translateY: 0, 
                            duration: 50,
                            easing: 'easeOutQuad'
                        });

                        setLockedBars(prev => [...prev, activeIndex]);
                        
                        if (activeIndex === bars.length - 1) {
                            setWon(true);
                            setTimeout(() => { 
                                setLockedBars([]);
                                setActiveIndex(0);
                                setWon(false);
                            }, 4000);
                        } else { 
                            setActiveIndex(activeIndex + 1); 
                        }
                    } else if (activeIndex > 0) {
                        const prevIndex = activeIndex - 1;
                        setLockedBars(prev => prev.filter(item => item !== prevIndex));
                        animations.current[prevIndex].play();
                        setActiveIndex(prevIndex);
                    }
                };
                window.addEventListener('mousedown', handleInteraction);
                return () => window.removeEventListener('mousedown', handleInteraction);
            }, [activeIndex, won]);

            return (
                <div className="window-frame">
                    <div className="header">
                        <h1 className="header-title">DATA CRACK</h1>
                        <div className="header-subtitle">SELLING YOUR SECRETS SINCE 1996</div>
                    </div>
                    
                    <div className="crack-container">
                        <div className="red-boundary"></div>
                        <div className="target-line" />
                        {won && <div className="win-message">WINNER WINNER CHICKEN DINNER</div>}
                        
                        {bars.map((i) => (
                            <div 
                                key={`${won}-${i}`}
                                id={`col-${i}`} 
                                className={`slider-column ${i === activeIndex ? 'active' : ''}`}
                            >
                                <div className="part" />
                                <div className="spacer" ref={refs.current[i]} />
                                <div className="part" />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
